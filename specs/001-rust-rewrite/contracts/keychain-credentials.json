{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ClaudeCodeKeychainCredentials",
  "description": "JSON structure stored in macOS Keychain under 'Claude Code-credentials'",

  "keychain_entry": {
    "service": "Claude Code-credentials",
    "account": "",
    "description": "Generic password entry in default keychain"
  },

  "retrieval": {
    "cli_command": "security find-generic-password -s 'Claude Code-credentials' -w",
    "rust_crate": "security-framework",
    "function": "find_generic_password"
  },

  "value_schema": {
    "type": "object",
    "required": ["claudeAiOauth"],
    "properties": {
      "claudeAiOauth": {
        "type": "object",
        "required": ["accessToken"],
        "properties": {
          "accessToken": {
            "type": "string",
            "pattern": "^sk-ant-oat[0-9]+-",
            "description": "OAuth access token for API authentication"
          },
          "refreshToken": {
            "type": "string",
            "pattern": "^sk-ant-ort[0-9]+-",
            "description": "OAuth refresh token (not used by status line)"
          },
          "expiresAt": {
            "type": "integer",
            "description": "Unix timestamp (milliseconds) when token expires"
          },
          "scopes": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "OAuth scopes granted to this token",
            "examples": [["user:inference", "user:profile"]]
          }
        }
      }
    }
  },

  "error_conditions": {
    "not_found": {
      "description": "Keychain entry does not exist",
      "cause": "User has not authenticated with Claude Code",
      "action": "Display 'No creds', prompt user to authenticate"
    },
    "access_denied": {
      "description": "Keychain access denied by macOS",
      "cause": "User denied keychain access prompt, or app not authorized",
      "action": "Display 'No creds', explain permission issue in stderr"
    },
    "invalid_json": {
      "description": "Keychain value is not valid JSON",
      "cause": "Corrupted entry or incompatible Claude Code version",
      "action": "Display 'No creds', suggest re-authenticating"
    },
    "missing_token": {
      "description": "JSON structure missing accessToken field",
      "cause": "Incomplete OAuth flow or corrupted entry",
      "action": "Display 'No creds', suggest re-authenticating"
    }
  },

  "example_value": {
    "claudeAiOauth": {
      "accessToken": "sk-ant-oat01-abcdef123456...",
      "refreshToken": "sk-ant-ort01-xyz789...",
      "expiresAt": 1748276587173,
      "scopes": ["user:inference", "user:profile"]
    }
  }
}
